<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja przedstawiajƒÖca cenzurƒô kartograficznƒÖ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://js.arcgis.com/4.33/esri/themes/light/main.css">

    <!-- Additional styles for new features -->
    <style>
    /* NEW STYLES FOR RASTER UPLOAD AND GEOREFERENCING */

    /* Divider for upload options */
    .divider {
        text-align: center;
        margin: var(--space-16) 0;
        position: relative;
        color: var(--color-text-secondary);
        font-size: var(--font-size-sm);
    }

    .divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background-color: var(--color-border);
        z-index: 1;
    }

    .divider::after {
        content: 'lub';
        background-color: var(--color-surface);
        padding: 0 var(--space-8);
        position: relative;
        z-index: 2;
    }

    /* Georeferencing controls */
    .georef-controls {
        margin-top: var(--space-16);
        padding: var(--space-16);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        background-color: var(--color-secondary);
    }

    .georef-controls h4 {
        margin: 0 0 var(--space-16) 0;
        font-size: var(--font-size-lg);
        color: var(--color-text);
    }

    .corner-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-12);
        margin-bottom: var(--space-16);
    }

    .corner-input {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
    }

    .corner-input label {
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        color: var(--color-text);
    }

    .corner-input input {
        padding: var(--space-6) var(--space-8);
        font-size: var(--font-size-sm);
    }

    /* Google Drive picker styles */
    #googleDriveBtn {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-8);
    }

    /* Upload panel positioning for multiple panels */
    #rasterUploadPanel {
        position: fixed;
        top: 70px;
        right: var(--space-16);
        background-color: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-16);
        box-shadow: var(--shadow-md);
        z-index: 999;
        min-width: 350px;
        max-width: 400px;
        max-height: 80vh;
        overflow-y: auto;
    }

    /* Drive file picker styles */
    .drive-file-list {
        max-height: 400px;
        overflow-y: auto;
        display: grid;
        gap: var(--space-8);
    }

    .drive-file-item {
        display: flex;
        align-items: center;
        gap: var(--space-12);
        padding: var(--space-12);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        cursor: pointer;
        transition: background-color var(--duration-fast);
    }

    .drive-file-item:hover {
        background-color: var(--color-secondary);
    }

    .drive-file-item img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: var(--radius-sm);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        #rasterUploadPanel {
            top: 90px;
            left: var(--space-8);
            right: var(--space-8);
            min-width: auto;
            max-width: none;
        }

        .corner-inputs {
            grid-template-columns: 1fr;
            gap: var(--space-8);
        }
    }
    </style>

    <!-- shpjs library for shapefile parsing -->
    <script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>
    <script src="https://js.arcgis.com/4.33/"></script>
</head>
<body>
    <!-- Toolbar -->
    <div id="toolbar">
        <div class="toolbar-content">
            <h1 class="toolbar-title">üìç Serwis przedstawiajƒÖcy przyk≈Çady cenzury kartograficznej</h1>
            <div class="toolbar-buttons">
                <button class="toolbar-btn" id="aboutBtn">‚ÑπÔ∏è O programie</button>
                <button class="toolbar-btn" id="mapAnalystBtn">üìä MapAnalyst</button>
                <button class="toolbar-btn" id="georefBtn">üó∫Ô∏è Georeferencja</button>
                <button class="toolbar-btn" id="uploadShpBtn">üìÅ Dodaj SHP</button>
                <button class="toolbar-btn" id="uploadRasterBtn">üñºÔ∏è Dodaj Raster</button>
            </div>
        </div>
    </div>

    <!-- Upload Panel for Shapefiles -->
    <div class="upload-panel hidden" id="uploadPanel">
        <div class="upload-content">
            <h3>üìÅ Dodaj warstwƒô shapefile</h3>
            <div class="file-input-container">
                <input type="file" id="fileInput" accept=".zip" style="display: none;">
                <label for="fileInput" class="file-label">Wybierz plik ZIP</label>
                <div id="fileName" class="file-name"></div>
            </div>
            <div class="progress-container hidden" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">≈Åadowanie...</div>
            </div>
            <button id="addLayerBtn" class="btn btn--secondary" disabled>Dodaj warstwƒô</button>
        </div>
    </div>

    <!-- NEW: Upload Panel for Raster Files -->
    <div class="upload-panel hidden" id="rasterUploadPanel">
        <div class="upload-content">
            <h3>üñºÔ∏è Dodaj warstwƒô rastrowƒÖ</h3>
            <div class="file-input-container">
                <input type="file" id="rasterFileInput" accept=".jpg,.jpeg,.png,.tiff,.tif,.geotiff" style="display: none;">
                <label for="rasterFileInput" class="file-label">Wybierz obraz</label>
                <div id="rasterFileName" class="file-name"></div>
            </div>




            <!-- Georeferencing controls (shown when file is selected) -->
            <div class="georef-controls hidden" id="georefControls">
                <h4>üìç Ustawienia georeferencji</h4>
                <div class="form-group">
                    <label class="form-label">Wsp√≥≈Çrzƒôdne naro≈ºnik√≥w (WGS84):</label>
                    <div class="corner-inputs">
                        <div class="corner-input">
                            <label>P√≥≈Çnocno-zachodnia (NW):</label>
                            <input type="number" id="nwLng" placeholder="D≈Çugo≈õƒá" step="any" class="form-control">
                            <input type="number" id="nwLat" placeholder="Szeroko≈õƒá" step="any" class="form-control">
                        </div>
                        <div class="corner-input">
                            <label>P√≥≈Çnocno-wschodnia (NE):</label>
                            <input type="number" id="neLng" placeholder="D≈Çugo≈õƒá" step="any" class="form-control">
                            <input type="number" id="neLat" placeholder="Szeroko≈õƒá" step="any" class="form-control">
                        </div>
                        <div class="corner-input">
                            <label>Po≈Çudniowo-zachodnia (SW):</label>
                            <input type="number" id="swLng" placeholder="D≈Çugo≈õƒá" step="any" class="form-control">
                            <input type="number" id="swLat" placeholder="Szeroko≈õƒá" step="any" class="form-control">
                        </div>
                        <div class="corner-input">
                            <label>Po≈Çudniowo-wschodnia (SE):</label>
                            <input type="number" id="seLng" placeholder="D≈Çugo≈õƒá" step="any" class="form-control">
                            <input type="number" id="seLat" placeholder="Szeroko≈õƒá" step="any" class="form-control">
                        </div>
                    </div>
                </div>
                
            </div>

            <div class="progress-container hidden" id="rasterProgressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="rasterProgressFill"></div>
                </div>
                <div class="progress-text" id="rasterProgressText">≈Åadowanie...</div>
            </div>
            <button id="addRasterLayerBtn" class="btn btn--secondary" disabled>Dodaj warstwƒô rastrowƒÖ</button>
        </div>
    </div>

    <!-- Map container -->
    <div id="viewDiv"></div>

    <!-- Splash Screen Modal -->
    <div class="modal hidden" id="splashScreen">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìç O programie</h2>
                <button class="close-btn" id="closeSplash">&times;</button>
            </div>
            <div class="modal-body">
                <p>
                    <strong>Aplikacja przedstawiajƒÖca cenzurƒô w kartografii</strong> to serwis zaprojektowany w ramach
                    pracy magisterskiej pod tytu≈Çem Cenzura w kartografii ‚Äì koncepcja i wykonanie serwisu internetowego przygotowanej pod kierunkiem
                    dr hab. Beaty Konopskiej przez Paw≈Ça Gila. Aplikacja internetowa s≈Çu≈ºy
                    do zarzƒÖdzania danymi geograficznymi i obs≈Çuguje zar√≥wno warstwy wektorowe jak i rastrowe.
                </p>
                <p><strong>Funkcjonalno≈õci aplikacji:</strong></p>
                <ul>
                    <li>üìÅ Obs≈Çuga plik√≥w shapefile (format ZIP)</li>
                    <li>üñºÔ∏è Dodawanie warstw rastrowych (JPG, PNG, TIFF)</li>
                    <li>üó∫Ô∏è Narzƒôdzia do georeferencji obraz√≥w</li>
                    <li>üìä Integracja z MapAnalyst</li>
                </ul>
                <p>
                    Aplikacja wykorzystuje  technologie ArcGIS JavaScript API 4.33 
                    oraz MediaLayer do obs≈Çugi obraz√≥w rastrowych.
                </p>
                <p><strong>Instrukcja u≈ºycia:</strong></p>
                <ol>
                    <li>Kliknij "Dodaj SHP" aby dodaƒá warstwy wektorowe</li>
                    <li>Kliknij "Dodaj Raster" aby dodaƒá obrazy rastrowe</li>
                    <li>U≈ºyj "Georeferencja" aby skorzystaƒá z Map Warper</li>
                    <li>Wprowad≈∫ wsp√≥≈Çrzƒôdne naro≈ºnik√≥w dla georeferencji</li>
                </ol>
            </div>
            <div class="modal-footer">
                <button class="btn btn--primary" id="closeSplashBtn">Zamknij</button>
            </div>
        </div>
    </div>

    <!-- NEW: Georeferencing Help Modal -->
    <div class="modal hidden" id="georefHelpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üó∫Ô∏è Pomoc - Georeferencja</h2>
                <button class="close-btn" id="closeGeorefHelp">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>Georeferencja</strong> to proces przypisywania wsp√≥≈Çrzƒôdnych geograficznych do obrazu rastrowego.</p>

                <h4>Opcje georeferencji:</h4>
                <ul>
                    <li><strong>Wewnƒôtrzne narzƒôdzie:</strong> Wprowad≈∫ wsp√≥≈Çrzƒôdne naro≈ºnik√≥w obrazu rƒôcznie</li>
                    <li><strong>Map Warper:</strong> Skorzystaj z zewnƒôtrznego narzƒôdzia do precyzyjnej georeferencji</li>
                </ul>

                <h4>Jak u≈ºywaƒá Map Warper:</h4>
                <ol>
                    <li>Kliknij przycisk "Georeferencja" w g√≥rnym menu</li>
                    <li>Wybierz "Map Warper" i zostaniesz przekierowany na stronƒô</li>
                    <li>Utw√≥rz konto na mapwarper.net</li>
                    <li>Prze≈õlij sw√≥j obraz do Map Warper</li>
                    <li>Dodaj punkty kontrolne dopasowujƒÖc obraz do mapy referencyjnej</li>
                    <li>Eksportuj jako GeoTIFF lub PNG</li>
                    <li>Wr√≥ƒá do aplikacji i dodaj georeferowany obraz</li>
                </ol>

                <h4>Wsp√≥≈Çrzƒôdne naro≈ºnik√≥w:</h4>
                <p>Je≈õli znasz wsp√≥≈Çrzƒôdne naro≈ºnik√≥w obrazu, wprowad≈∫ je w polach:</p>
                <ul>
                    <li><strong>NW:</strong> P√≥≈Çnocno-zachodni naro≈ºnik</li>
                    <li><strong>NE:</strong> P√≥≈Çnocno-wschodni naro≈ºnik</li>
                    <li><strong>SW:</strong> Po≈Çudniowo-zachodni naro≈ºnik</li>
                    <li><strong>SE:</strong> Po≈Çudniowo-wschodni naro≈ºnik</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn--primary" id="closeGeorefHelpBtn">Zamknij</button>
            </div>
        </div>
    </div>

    <!-- Load the updated JavaScript application -->
    <script src="script.js"></script>
</body>
</html>